swagger: '2.0'
info:
  title: MilMove PPTAS API
  version: 0.0.1
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  contact:
    email: milmove-developers@caci.com
  description: >
    The Prime API is a RESTful API that enables the Prime contractor to request

    information about upcoming moves, update the details and status of those
    moves,

    and make payment requests. It uses Mutual TLS for authentication procedures.


    All endpoints are located at `/prime/v1/`.
basePath: /prime/pptas
host: primelocal
consumes:
  - application/json
produces:
  - application/json
schemes:
  - http
tags:
  - name: moves
paths:
  /test/get-moves-since:
    post:
      tags:
        - moves
      summary: summary
      description: summary2
      operationId: movesSince
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/movesSince'
      responses:
        '200':
          description: Moves returned sucessfully
          schema:
            $ref: '#/definitions/GetMovesSinceResponse'
        '400':
          $ref: '#/responses/PermissionDenied'
        '401':
          $ref: '#/responses/PermissionDenied'
        '500':
          $ref: '#/responses/ServerError'
  /moves:
    get:
      summary: listMoves
      description: >
        Gets all moves that have been reviewed and approved by the TOO. The
        `since` parameter can be used to filter this

        list down to only the moves that have been updated since the provided
        timestamp. A move will be considered

        updated if the `updatedAt` timestamp on the move or on its orders,
        shipments, service items, or payment

        requests, is later than the provided date and time.


        **WIP**: Include what causes moves to leave this list. Currently, once
        the `availableToPrimeAt` timestamp has

        been set, that move will always appear in this list.
      operationId: listMoves
      tags:
        - moves
      produces:
        - application/json
      parameters:
        - in: query
          name: since
          type: string
          format: date-time
          description: >-
            Only return moves updated since this time. Formatted like
            "2021-07-23T18:30:47.116Z"
      responses:
        '200':
          description: >-
            Successfully retrieved moves. A successful fetch might still return
            zero moves.
          schema:
            $ref: '#/definitions/ListMoves'
        '401':
          $ref: '#/responses/PermissionDenied'
        '403':
          $ref: '#/responses/PermissionDenied'
        '500':
          $ref: '#/responses/ServerError'
definitions:
  movesSince:
    type: object
    properties:
      moveSinceDate:
        type: string
        description: moves retrieved since this date
        format: date-time
      numMoves:
        type: integer
        description: number of moves to return
  MoveStatus:
    type: string
    enum:
      - DRAFT
      - SUBMITTED
      - APPROVED
      - CANCELED
  GBLOC:
    type: string
    enum:
      - AGFM
      - APAT
      - BGAC
      - BGNC
      - BKAS
      - CFMQ
      - CLPK
      - CNNQ
      - DMAT
      - GSAT
      - HAFC
      - HBAT
      - JEAT
      - JENQ
      - KKFA
      - LHNQ
      - LKNQ
      - MAPK
      - MAPS
      - MBFL
      - MLNQ
      - XXXX
  SearchMove:
    type: object
    properties:
      id:
        type: string
        format: uuid
      firstName:
        type: string
        example: John
        x-nullable: true
      lastName:
        type: string
        example: Doe
        x-nullable: true
      dodID:
        type: string
        example: '1234567890'
        x-nullable: true
      status:
        $ref: '#/definitions/MoveStatus'
      locator:
        type: string
      branch:
        type: string
      shipmentsCount:
        type: integer
      originDutyLocationPostalCode:
        format: zip
        type: string
        title: ZIP
        example: '90210'
        pattern: ^(\d{5})$
      destinationDutyLocationPostalCode:
        format: zip
        type: string
        title: ZIP
        example: '90210'
        pattern: ^(\d{5})$
      requestedPickupDate:
        type: string
        format: date
        x-nullable: true
      requestedDeliveryDate:
        type: string
        format: date
        x-nullable: true
      originGBLOC:
        $ref: '#/definitions/GBLOC'
      destinationGBLOC:
        $ref: '#/definitions/GBLOC'
      orderType:
        type: string
  SearchMoves:
    type: array
    items:
      $ref: '#/definitions/SearchMove'
  GetMovesSinceResponse:
    type: object
    properties:
      movesFound:
        $ref: '#/definitions/SearchMoves'
  ClientError:
    type: object
    properties:
      title:
        type: string
      detail:
        type: string
      instance:
        type: string
        format: uuid
    required:
      - title
      - detail
      - instance
  ListMove:
    description: >
      An abbreviated definition for a move, without all the nested information
      (shipments, service items, etc). Used to fetch a list of moves more
      efficiently.
    type: object
    properties:
      id:
        example: 1f2270c7-7166-40ae-981e-b200ebdf3054
        format: uuid
        type: string
      moveCode:
        type: string
        example: HYXFJF
        readOnly: true
      createdAt:
        format: date-time
        type: string
        readOnly: true
      orderID:
        example: c56a4180-65aa-42ec-a945-5fd21dec0538
        format: uuid
        type: string
      referenceId:
        example: 1001-3456
        type: string
      availableToPrimeAt:
        format: date-time
        type: string
        x-nullable: true
        readOnly: true
      updatedAt:
        format: date-time
        type: string
        readOnly: true
      ppmType:
        type: string
        enum:
          - FULL
          - PARTIAL
      eTag:
        type: string
        readOnly: true
  ListMoves:
    type: array
    items:
      $ref: '#/definitions/ListMove'
responses:
  PermissionDenied:
    description: The request was denied.
    schema:
      $ref: '#/definitions/ClientError'
  ServerError:
    description: An unexpected error has occurred in the server.
    schema:
      $ref: '#/definitions/ClientError'
